<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agric Advisor Global | Premium Intelligence</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='index.css') }}">
</head>

<body>

    <div class="glass-card">
        <h1>üåç Agric Advisor Global</h1>
        <p class="subtitle">Premium Agronomic Intelligence for a Sustainable Future</p>

        <form id="advisorForm">
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="location" class="form-label">Global Location</label>
                    <input type="text" class="form-control" id="location" name="location"
                        placeholder="e.g. London, New York, Lagos" required>
                </div>
                <div class="col-md-6">
                    <label for="crop" class="form-label">Crop Type</label>
                    <input type="text" class="form-control" id="crop" name="crop" placeholder="e.g. Wheat, Corn, Soya"
                        required>
                </div>
                <div class="col-md-6">
                    <label for="language" class="form-label">Localized Language</label>
                    <select class="form-select" id="language" name="language">
                        <optgroup label="Global">
                            <option value="English">English</option>
                            <option value="Spanish">Espa√±ol (Spanish)</option>
                            <option value="French">Fran√ßais (French)</option>
                            <option value="German">Deutsch (German)</option>
                            <option value="Portuguese">Portugu√™s (Portuguese)</option>
                            <option value="Italian">Italiano (Italian)</option>
                        </optgroup>
                        <optgroup label="Regional (West Africa)">
                            <option value="Yoruba">Yoruba</option>
                            <option value="Hausa">Hausa</option>
                            <option value="Igbo">Igbo</option>
                            <option value="Pidgin">Pidgin</option>
                        </optgroup>
                    </select>
                </div>
                <div class="col-md-6">
                    <label for="phone" class="form-label">SMS Alert (Optional)</label>
                    <input type="tel" class="form-control" id="phone" name="phone" placeholder="+1, +44, +234...">
                </div>
            </div>
            <button type="submit" class="btn-premium mt-4">Generate Global Insight</button>
        </form>

        <!-- Loader -->
        <div class="loader-container">
            <div class="spinner"></div>
            <p class="mt-3">Analyzing Global Markets & Climate Data...</p>
        </div>

        <!-- Results -->
        <div id="result" class="result-section">
            <div class="advice-header">
                ‚ú® Strategic Advisor Recommendation
            </div>

            <div class="advice-card">
                <p id="adviceText" style="line-height: 1.6;"></p>
                <div id="audioContainer" style="display:none;">
                    <p class="mt-3 mb-1" style="font-size: 0.8rem; opacity: 0.7;">Vocalized Advice:</p>
                    <audio id="adviceAudio" controls></audio>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label">Local Market</div>
                    <div id="marketStat" class="stat-value">---</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Weather</div>
                    <div id="weatherStat" class="stat-value">---</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Conditions</div>
                    <div id="conditionStat" class="stat-value">---</div>
                </div>
            </div>

            <div class="mt-3 text-center">
                <small id="smsStatus" class="footer-text" style="color: var(--accent-color);"></small>
            </div>
        </div>

        <p class="footer-text">Powered by Gemini AI Intelligence ‚Ä¢ Global Agriculture Index 2026</p>
    </div>

    <script>
        document.getElementById('advisorForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const resultBox = document.getElementById('result');
            const loader = document.querySelector('.loader-container');
            const adviceText = document.getElementById('adviceText');
            const smsStatus = document.getElementById('smsStatus');
            const marketStat = document.getElementById('marketStat');
            const weatherStat = document.getElementById('weatherStat');
            const conditionStat = document.getElementById('conditionStat');

            resultBox.style.display = 'none';
            loader.style.display = 'block';

            const formData = new FormData(this);

            try {
                const response = await fetch('/get_advice', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();

                loader.style.display = 'none';
                resultBox.style.display = 'block';

                if (data.error) {
                    adviceText.innerHTML = `<span style="color: #ff6b6b">Logic Error: ${data.error}</span>`;
                } else {
                    adviceText.innerText = data.advice;

                    // Populate Stats
                    if (data.data) {
                        marketStat.innerText = data.data.market.current_price || "N/A";
                        weatherStat.innerText = data.data.weather.temperature + "¬∞C";
                        conditionStat.innerText = data.data.weather.condition;
                    }

                    const audioContainer = document.getElementById('audioContainer');
                    const adviceAudio = document.getElementById('adviceAudio');

                    if (data.audio_file) {
                        adviceAudio.src = "/static/audio/" + data.audio_file;
                        audioContainer.style.display = 'block';
                    } else {
                        audioContainer.style.display = 'none';
                    }

                    if (data.sms_status) {
                        smsStatus.innerText = "‚úì Alert Sent: " + data.sms_status;
                    } else {
                        smsStatus.innerText = "";
                    }
                }
            } catch (error) {
                loader.style.display = 'none';
                resultBox.style.display = 'block';
                adviceText.innerText = "An error occurred: " + error.message;
            }
        });
    </script>
</body>

</html>